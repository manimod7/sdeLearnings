package lld.youtubetrending;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Random;

/**
 * Demo class showcasing the YouTube Trending System
 * Demonstrates video ingestion, trending calculation, and analytics
 */
public class YouTubeTrendingDemo {
    private static final TrendingService service = new TrendingService();
    private static final Random random = new Random();
    
    public static void main(String[] args) {
        System.out.println("📺 YouTube Trending System Demo");
        System.out.println("===============================");
        
        // Run comprehensive demo scenarios
        runDemoScenarios();
        
        // Cleanup
        service.shutdown();
        System.out.println("\n🎉 Demo completed successfully!");
    }
    
    /**
     * Run comprehensive demo scenarios
     */
    private static void runDemoScenarios() {
        System.out.println("\n🚀 Running Demo Scenarios...\n");
        
        // Scenario 1: Video ingestion and basic trending
        System.out.println("Scenario 1: Video Ingestion and Basic Trending");
        System.out.println("----------------------------------------------");
        
        // Add sample videos
        addSampleVideos();
        System.out.println("✅ Added 15 sample videos across different categories");
        
        // Simulate initial metrics
        simulateInitialMetrics();
        System.out.println("✅ Simulated initial view and engagement metrics");
        
        // Scenario 2: Trending algorithm demonstration
        System.out.println("\nScenario 2: Trending Algorithm Demonstration");
        System.out.println("--------------------------------------------");
        
        // Get global trending videos
        List<Video> globalTrending = service.getTrendingVideos(null, null, 0, 10);
        System.out.println("✅ Top 10 Global Trending Videos:");
        displayVideoList(globalTrending);
        
        // Get category-specific trending
        List<Video> musicTrending = service.getTrendingVideos(null, VideoCategory.MUSIC, 0, 5);
        System.out.println("\n✅ Top 5 Music Trending Videos:");
        displayVideoList(musicTrending);
        
        // Scenario 3: Real-time metric updates
        System.out.println("\nScenario 3: Real-time Metric Updates");
        System.out.println("------------------------------------");
        
        // Simulate viral video scenario
        simulateViralVideo("video_001");
        System.out.println("✅ Simulated viral video scenario for video_001");
        
        // Show updated trending after viral event
        Video viralVideo = service.getVideo("video_001");
        if (viralVideo != null) {\n            System.out.printf(\"   Updated metrics - Views: %d, Score: %.3f, Rank: %d%%\\n\",\n                viralVideo.getViewCount(), viralVideo.getTrendingScore(), viralVideo.getPercentileRank());\n        }\n        \n        // Scenario 4: Regional trending analysis\n        System.out.println(\"\\nScenario 4: Regional Trending Analysis\");\n        System.out.println(\"--------------------------------------\");\n        \n        // Get region-specific trending\n        List<Video> usTrending = service.getTrendingVideos(\"US\", null, 0, 5);\n        List<Video> ukTrending = service.getTrendingVideos(\"UK\", null, 0, 5);\n        \n        System.out.println(\"✅ Top 5 US Trending Videos:\");\n        displayVideoList(usTrending);\n        \n        System.out.println(\"\\n✅ Top 5 UK Trending Videos:\");\n        displayVideoList(ukTrending);\n        \n        // Scenario 5: Search and discovery\n        System.out.println(\"\\nScenario 5: Search and Discovery\");\n        System.out.println(\"--------------------------------\");\n        \n        // Search videos\n        List<Video> musicSearchResults = service.searchVideos(\"music\", null, null, 5);\n        System.out.println(\"✅ Search results for 'music':\");\n        displayVideoList(musicSearchResults);\n        \n        List<Video> gamingSearchResults = service.searchVideos(\"\", VideoCategory.GAMING, null, 3);\n        System.out.println(\"\\n✅ Gaming category videos:\");\n        displayVideoList(gamingSearchResults);\n        \n        // Scenario 6: Analytics and reporting\n        System.out.println(\"\\nScenario 6: Analytics and Reporting\");\n        System.out.println(\"-----------------------------------\");\n        \n        // Generate system statistics\n        TrendingService.SystemStats stats = service.getSystemStats();\n        System.out.println(\"✅ System Statistics:\");\n        System.out.println(\"   Total Videos: \" + stats.getTotalVideos());\n        System.out.println(\"   Average Trending Score: \" + String.format(\"%.3f\", stats.getAvgTrendingScore()));\n        System.out.println(\"   Videos by Category: \" + stats.getVideosByCategory());\n        System.out.println(\"   Videos by Region: \" + stats.getVideosByRegion());\n        \n        // Generate trending report\n        LocalDateTime reportStart = LocalDateTime.now().minusHours(24);\n        LocalDateTime reportEnd = LocalDateTime.now();\n        \n        TrendingService.TrendingReport report = service.generateReport(\n            \"US\", VideoCategory.ENTERTAINMENT, reportStart, reportEnd\n        );\n        \n        System.out.println(\"\\n✅ 24-hour US Entertainment Report:\");\n        System.out.println(\"   Videos in Report: \" + report.getVideoCount());\n        System.out.println(\"   Total Views: \" + formatNumber(report.getTotalViews()));\n        System.out.println(\"   Average Score: \" + String.format(\"%.3f\", report.getAvgTrendingScore()));\n        \n        // Scenario 7: Algorithm parameter tuning\n        System.out.println(\"\\nScenario 7: Algorithm Parameter Tuning\");\n        System.out.println(\"--------------------------------------\");\n        \n        // Update parameters for news category (more freshness-focused)\n        TrendingParameters newsParams = TrendingParameters.createCategoryParameters(VideoCategory.NEWS);\n        service.updateAlgorithmParameters(VideoCategory.NEWS, newsParams);\n        System.out.println(\"✅ Updated algorithm parameters for NEWS category\");\n        \n        // Recalculate scores with new parameters\n        service.recalculateAllScores();\n        System.out.println(\"✅ Recalculated trending scores with updated parameters\");\n        \n        // Wait a moment for recalculation\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        // Show updated news trending\n        List<Video> newsTrending = service.getTrendingVideos(null, VideoCategory.NEWS, 0, 3);\n        System.out.println(\"\\n✅ Updated News Trending (freshness-optimized):\");\n        displayVideoList(newsTrending);\n        \n        // Scenario 8: Detailed video analysis\n        System.out.println(\"\\nScenario 8: Detailed Video Analysis\");\n        System.out.println(\"-----------------------------------\");\n        \n        demonstrateDetailedAnalysis();\n    }\n    \n    /**\n     * Add sample videos for demonstration\n     */\n    private static void addSampleVideos() {\n        // Entertainment videos\n        service.addVideo(new Video(\n            \"video_001\", \"Amazing Cat Compilation 2024\", \"channel_fun\", \"Fun Videos\",\n            VideoCategory.ENTERTAINMENT, \"US\", 600,\n            \"Hilarious cat moments that will make you laugh\",\n            new String[]{\"cats\", \"funny\", \"compilation\", \"pets\"},\n            \"https://img.youtube.com/vi/video_001/maxresdefault.jpg\"\n        ));\n        \n        service.addVideo(new Video(\n            \"video_002\", \"Epic Movie Trailer Reactions\", \"channel_react\", \"React Channel\",\n            VideoCategory.ENTERTAINMENT, \"US\", 720,\n            \"Professional movie critics react to latest trailers\",\n            new String[]{\"movies\", \"reactions\", \"trailers\", \"entertainment\"},\n            \"https://img.youtube.com/vi/video_002/maxresdefault.jpg\"\n        ));\n        \n        // Music videos\n        service.addVideo(new Video(\n            \"video_003\", \"New Hit Song - Official Music Video\", \"channel_music\", \"Pop Star Records\",\n            VideoCategory.MUSIC, \"US\", 240,\n            \"The latest hit single from popular artist\",\n            new String[]{\"music\", \"official\", \"hit\", \"pop\"},\n            \"https://img.youtube.com/vi/video_003/maxresdefault.jpg\"\n        ));\n        \n        service.addVideo(new Video(\n            \"video_004\", \"Classical Piano Performance\", \"channel_classical\", \"Classical Music Hub\",\n            VideoCategory.MUSIC, \"UK\", 1800,\n            \"Beautiful classical piano performance in concert hall\",\n            new String[]{\"classical\", \"piano\", \"concert\", \"music\"},\n            \"https://img.youtube.com/vi/video_004/maxresdefault.jpg\"\n        ));\n        \n        // Gaming videos\n        service.addVideo(new Video(\n            \"video_005\", \"Ultimate Gaming Setup Tour 2024\", \"channel_gaming\", \"Pro Gamer Setup\",\n            VideoCategory.GAMING, \"US\", 900,\n            \"Tour of the most expensive gaming setup ever built\",\n            new String[]{\"gaming\", \"setup\", \"tour\", \"expensive\"},\n            \"https://img.youtube.com/vi/video_005/maxresdefault.jpg\"\n        ));\n        \n        service.addVideo(new Video(\n            \"video_006\", \"Speedrun World Record Attempt\", \"channel_speedrun\", \"Speedrun Central\",\n            VideoCategory.GAMING, \"UK\", 3600,\n            \"Attempting to break the world record speedrun\",\n            new String[]{\"speedrun\", \"worldrecord\", \"gaming\", \"challenge\"},\n            \"https://img.youtube.com/vi/video_006/maxresdefault.jpg\"\n        ));\n        \n        // News videos\n        service.addVideo(new Video(\n            \"video_007\", \"Breaking: Major Tech Announcement\", \"channel_news\", \"Tech News Daily\",\n            VideoCategory.NEWS, \"US\", 480,\n            \"Live coverage of major technology company announcement\",\n            new String[]{\"breaking\", \"tech\", \"announcement\", \"news\"},\n            \"https://img.youtube.com/vi/video_007/maxresdefault.jpg\"\n        ));\n        \n        service.addVideo(new Video(\n            \"video_008\", \"Global Climate Summit Updates\", \"channel_world\", \"World News Network\",\n            VideoCategory.NEWS, \"UK\", 1200,\n            \"Latest updates from the global climate summit\",\n            new String[]{\"climate\", \"summit\", \"global\", \"environment\"},\n            \"https://img.youtube.com/vi/video_008/maxresdefault.jpg\"\n        ));\n        \n        // Education videos\n        service.addVideo(new Video(\n            \"video_009\", \"How Quantum Computing Actually Works\", \"channel_science\", \"Science Explained\",\n            VideoCategory.EDUCATION, \"US\", 1500,\n            \"Detailed explanation of quantum computing principles\",\n            new String[]{\"quantum\", \"computing\", \"science\", \"education\"},\n            \"https://img.youtube.com/vi/video_009/maxresdefault.jpg\"\n        ));\n        \n        service.addVideo(new Video(\n            \"video_010\", \"Learn Python in 10 Minutes\", \"channel_coding\", \"Code Academy\",\n            VideoCategory.EDUCATION, \"UK\", 600,\n            \"Quick introduction to Python programming language\",\n            new String[]{\"python\", \"programming\", \"tutorial\", \"coding\"},\n            \"https://img.youtube.com/vi/video_010/maxresdefault.jpg\"\n        ));\n        \n        // Add more videos for variety\n        addMoreSampleVideos();\n    }\n    \n    private static void addMoreSampleVideos() {\n        // Sports videos\n        service.addVideo(new Video(\n            \"video_011\", \"Incredible Football Goals Compilation\", \"channel_sports\", \"Sports Highlights\",\n            VideoCategory.SPORTS, \"US\", 480,\n            \"Best football goals from this season\",\n            new String[]{\"football\", \"goals\", \"sports\", \"highlights\"},\n            \"https://img.youtube.com/vi/video_011/maxresdefault.jpg\"\n        ));\n        \n        // Technology videos\n        service.addVideo(new Video(\n            \"video_012\", \"iPhone 15 Pro Max Review\", \"channel_tech\", \"Tech Reviews Pro\",\n            VideoCategory.TECHNOLOGY, \"US\", 720,\n            \"Complete review of the latest iPhone model\",\n            new String[]{\"iphone\", \"review\", \"technology\", \"smartphone\"},\n            \"https://img.youtube.com/vi/video_012/maxresdefault.jpg\"\n        ));\n        \n        // Comedy videos\n        service.addVideo(new Video(\n            \"video_013\", \"Stand-up Comedy Special\", \"channel_comedy\", \"Comedy Central\",\n            VideoCategory.COMEDY, \"UK\", 3600,\n            \"Hilarious stand-up comedy performance\",\n            new String[]{\"comedy\", \"standup\", \"funny\", \"entertainment\"},\n            \"https://img.youtube.com/vi/video_013/maxresdefault.jpg\"\n        ));\n        \n        // Lifestyle videos\n        service.addVideo(new Video(\n            \"video_014\", \"Morning Routine of a CEO\", \"channel_lifestyle\", \"Success Stories\",\n            VideoCategory.LIFESTYLE, \"US\", 900,\n            \"How successful entrepreneurs start their day\",\n            new String[]{\"morning\", \"routine\", \"ceo\", \"lifestyle\"},\n            \"https://img.youtube.com/vi/video_014/maxresdefault.jpg\"\n        ));\n        \n        // Food videos\n        service.addVideo(new Video(\n            \"video_015\", \"Gordon Ramsay's Secret Recipe\", \"channel_food\", \"Master Chef Kitchen\",\n            VideoCategory.FOOD, \"UK\", 1200,\n            \"World-famous chef shares his secret recipe\",\n            new String[]{\"cooking\", \"recipe\", \"chef\", \"food\"},\n            \"https://img.youtube.com/vi/video_015/maxresdefault.jpg\"\n        ));\n    }\n    \n    /**\n     * Simulate initial metrics for all videos\n     */\n    private static void simulateInitialMetrics() {\n        String[] videoIds = {\n            \"video_001\", \"video_002\", \"video_003\", \"video_004\", \"video_005\",\n            \"video_006\", \"video_007\", \"video_008\", \"video_009\", \"video_010\",\n            \"video_011\", \"video_012\", \"video_013\", \"video_014\", \"video_015\"\n        };\n        \n        for (String videoId : videoIds) {\n            long views = 10000 + random.nextInt(90000); // 10K to 100K views\n            long likes = views / 50 + random.nextInt((int)(views / 25)); // 2-6% like rate\n            long comments = views / 200 + random.nextInt((int)(views / 100)); // 0.5-1.5% comment rate\n            long shares = views / 500 + random.nextInt((int)(views / 250)); // 0.2-0.6% share rate\n            long dislikes = likes / 10 + random.nextInt((int)(likes / 5)); // 10-30% of likes\n            \n            service.updateVideoMetrics(videoId, views, likes, comments, shares, dislikes);\n        }\n    }\n    \n    /**\n     * Simulate a video going viral\n     */\n    private static void simulateViralVideo(String videoId) {\n        // Massive spike in engagement\n        long viralViews = 5000000 + random.nextInt(5000000); // 5M to 10M views\n        long viralLikes = viralViews / 20; // 5% like rate\n        long viralComments = viralViews / 100; // 1% comment rate\n        long viralShares = viralViews / 50; // 2% share rate\n        long viralDislikes = viralLikes / 20; // Very low dislike rate for viral content\n        \n        service.updateVideoMetrics(videoId, viralViews, viralLikes, viralComments, viralShares, viralDislikes);\n    }\n    \n    /**\n     * Display list of videos with their metrics\n     */\n    private static void displayVideoList(List<Video> videos) {\n        for (int i = 0; i < videos.size(); i++) {\n            Video video = videos.get(i);\n            System.out.printf(\"   %d. %s [%s]\\n\", i + 1, video.getTitle(), video.getCategory().getDisplayName());\n            System.out.printf(\"      Channel: %s | Views: %s | Score: %.3f | Rank: %d%%\\n\",\n                video.getChannelName(),\n                formatNumber(video.getViewCount()),\n                video.getTrendingScore(),\n                video.getPercentileRank()\n            );\n        }\n    }\n    \n    /**\n     * Demonstrate detailed video analysis\n     */\n    private static void demonstrateDetailedAnalysis() {\n        Video topVideo = service.getTrendingVideos(null, null, 0, 1).get(0);\n        \n        System.out.println(\"📊 Detailed Analysis of Top Trending Video:\");\n        System.out.println(\"===========================================\");\n        System.out.println(\"Title: \" + topVideo.getTitle());\n        System.out.println(\"Channel: \" + topVideo.getChannelName());\n        System.out.println(\"Category: \" + topVideo.getCategory().getDisplayName());\n        System.out.println(\"Region: \" + topVideo.getRegion());\n        System.out.println(\"Upload Time: \" + topVideo.getUploadTime());\n        System.out.println(\"Duration: \" + formatDuration(topVideo.getDurationSeconds()));\n        \n        Video.VideoMetrics metrics = topVideo.getMetrics();\n        System.out.println(\"\\n📈 Engagement Metrics:\");\n        System.out.println(\"Views: \" + formatNumber(metrics.getViews()));\n        System.out.println(\"Likes: \" + formatNumber(metrics.getLikes()));\n        System.out.println(\"Comments: \" + formatNumber(metrics.getComments()));\n        System.out.println(\"Shares: \" + formatNumber(metrics.getShares()));\n        System.out.println(\"Dislikes: \" + formatNumber(metrics.getDislikes()));\n        \n        System.out.println(\"\\n🎯 Performance Indicators:\");\n        System.out.println(\"Engagement Rate: \" + String.format(\"%.2f%%\", metrics.getEngagementRate() * 100));\n        System.out.println(\"Like Ratio: \" + String.format(\"%.1f%%\", metrics.getLikeRatio() * 100));\n        System.out.println(\"Views per Hour: \" + formatNumber((long)metrics.getViewsPerHour()));\n        System.out.println(\"Video Age: \" + String.format(\"%.1f hours\", topVideo.getAgeInHours()));\n        \n        System.out.println(\"\\n🏆 Trending Metrics:\");\n        System.out.println(\"Trending Score: \" + String.format(\"%.4f\", metrics.getTrendingScore()));\n        System.out.println(\"Percentile Rank: \" + metrics.getPercentileRank() + \"%\");\n        System.out.println(\"Last Score Update: \" + topVideo.getLastScoreUpdate());\n    }\n    \n    /**\n     * Format large numbers with K, M, B suffixes\n     */\n    private static String formatNumber(long number) {\n        if (number >= 1_000_000_000) {\n            return String.format(\"%.1fB\", number / 1_000_000_000.0);\n        } else if (number >= 1_000_000) {\n            return String.format(\"%.1fM\", number / 1_000_000.0);\n        } else if (number >= 1_000) {\n            return String.format(\"%.1fK\", number / 1_000.0);\n        } else {\n            return String.valueOf(number);\n        }\n    }\n    \n    /**\n     * Format duration in seconds to human readable format\n     */\n    private static String formatDuration(int seconds) {\n        int hours = seconds / 3600;\n        int minutes = (seconds % 3600) / 60;\n        int secs = seconds % 60;\n        \n        if (hours > 0) {\n            return String.format(\"%d:%02d:%02d\", hours, minutes, secs);\n        } else {\n            return String.format(\"%d:%02d\", minutes, secs);\n        }\n    }\n}"